/*! Copyright (c) ZUIKU.COM - Author: LIJUN - Email: zwlijun@gmail.com */
define(function(require,exports,module){var a=$.Listener=require("mod/se/listener.222be46f03da5911721807bfda4b9b616035e3f6"),b=require("mod/polyfill/css.7891625883dcf7e67d40fc1000d57016eb4aa588"),c=require("mod/se/util.f9a416ff84aa85b8ba737234874f8969ce70e034"),d=require("mod/se/timer.74b69eae4780be6b48bedbac0cb9dc301018987f"),e=a.HandleStack,f={rotate:"mod/sa/effect/rotate.4946495d0062893ddc17a0c732836f2c755b5340",screen:"mod/sa/effect/screen.6116fe4f9436b6bd8efaadb38a8cee8898e4bf08",scale:"mod/sa/effect/scale.c62a0adbe57ab6ce41885a4be8cff6dd0a1c3c2f",draw:"mod/sa/effect/draw.01a01b8543aac190b54afc7ba6302967ed7691c7",fade:"mod/sa/effect/fade.bad365817b8726b3a4336b3f50536f672a5cc103",gallery:"mod/sa/effect/gallery.7af7caa62f35922889f348f2f751c3f93dd90ea9",circle:"mod/sa/effect/circle.52215e5665cb9f466eb80a10c262f951efafe0fe"},g={VERTICAL:"vertical",HORZIONTAL:"horizontal"},h=(b.hasProperty("perspective")?"translateZ(0)":"","ontouchstart"in window),i=h?"touchstart":"mousedown",j=h?"touchend":"mouseup",k=h?"touchmove":"mousemove",l=function(b,c,f,h){this.snap=b,this.scenes=$(b),this.size=this.scenes.length,this.stage=this.scenes.parent(),this.binded=!1,this.transitionEffect=c||"screen",this.direction=f||g.VERTICAL,this.moveDirection=0,this.lockedDirection=0,this.loop=!1!==h,this.firstPage=!0,this.lastPage=!1,this.sceneIndex=0,this.lastIndex=Math.max(this.size-1,0),this.enterScene=void 0,this.exitScene=void 0,this.waitingScene=void 0,this.leavingScene=void 0,this.enabled=!1,this.locked=!1,this.touchEnabled=!0,this.touched=!1,this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.moveRatio=.8,this.shiftRatio=.2,this.updateStageSize(),this.timer=d.getTimer(),this.handleStack=new e,this.listener=new a({oninteractive:null,onready:null,onshift:null,onvisible:null,onstart:null,onmove:null,onend:null,onmovement:null,oncomplete:null,onblock:null},this.handleStack)};l.prototype={exec:function(a,b){return this.listener.exec(a,b)},set:function(a,b){this.listener.set(a,b)},remove:function(a){this.listener.remove(a)},get:function(a){return this.listener.get(a)},clear:function(){this.listener.clear()},getHandleStack:function(){return this.handleStack},isHiddenScene:function(a){return c.isHiddenNode(a)},findRealValue:function(a,b,d){return c.findNodeRealSize(a,b,d)},getStageSize:function(){var a=c.getNodeRealSize(this.stage);return a},updateStageSize:function(){var a=this.getStageSize();this.offset=g.HORZIONTAL==this.direction?a.width:a.height},"import":function(a){var b=this,c=b.transitionEffect,d=f[c];c in b&&b[c]&&b[c].init?(b.exec("interactive",[!0]),b.updateSceneIndex(b.sceneIndex),b.run("init",[]),!1!==a&&b.bind(),b.enabled=!0,b.exec("ready",[!0])):require.async(d,function(e){if(!e)throw b.exec("interactive",[!1]),b.exec("ready",[!1]),new Error("this effect("+d+") not found.");b[c]=e,b.exec("interactive",[!0]),b.updateSceneIndex(b.sceneIndex),b.run("init",[]),!1!==a&&b.bind(),b.enabled=!0,b.exec("ready",[!0])})},run:function(a,b,c){var d=this,e=d[d.transitionEffect],f={"super":this,effect:e};c?setTimeout(function(){e[a].apply(f,b)},c):e[a].apply(f,b)},parseEffectAttributes:function(a){a=(a||"").replace(/[\s ]+/g,"");for(var b=a.split(";"),c=b.length,d=0;c>d;d++){var e=b[d].split(":"),f=e[0],g=e[1];this.setEffectAttribute(f,g)}},setEffectAttribute:function(a,b){this[this.transitionEffect][a]=b},getEffectAttribute:function(a){return this[this.transitionEffect][a]},setLocked:function(a){this.locked=a},setTouchEnabled:function(a){this.touchEnabled=!0===a},destroy:function(){this.off(),this.restore(0)},restore:function(a){this.moveDirection=0,this.lockedDirection=0,this.enterScene=void 0,this.exitScene=void 0,this.waitingScene=void 0,this.leavingScene=void 0,this.locked=!1,this.enabled=!0,this.touched=!1,this.moved=!1,this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.updateSceneIndex(a||0)},updateSceneSequence:function(a,b,c){var d=this.lastIndex,e=Math.min(Math.max(a,0),d);this.firstPage=0===e,this.lastPage=d===e,this.currentIndex=e,this.sceneIndex=e,this.prevIndex=void 0!==c?c:this.firstPage?d:a-1,this.nextIndex=void 0!==b?b:this.lastPage?0:a+1,this.prevSiblingIndex=this.prevIndex-1<0?d:this.prevIndex-1,this.nextSiblingIndex=this.nextIndex+1>d?0:this.nextIndex+1,this.currentScene=$(this.scenes[this.currentIndex])||null,this.nextScene=$(this.scenes[this.nextIndex])||null,this.prevScene=$(this.scenes[this.prevIndex])||null,this.nextSiblingScene=$(this.scenes[this.nextSiblingIndex])||null,this.prevSiblingScene=$(this.scenes[this.prevSiblingIndex])||null},updateSceneIndex:function(a){this.updateSceneSequence(a,void 0,void 0),this.enabled=!0,this.run("layout",[])},turn:function(a){if(!this.loop)switch(a){case 1:if(this.firstPage)return this.exec("block",[null,"firstpage"]),1;break;case-1:if(this.lastPage)return this.exec("block",[null,"lastpage"]),1}if(this.enabled&&!this.locked){var b=[null,0,0,0,0,0,this.currentIndex];this.enabled=!1,this.moveDirection=a,this.run("start",b),this.run("end",b,200)}else this.exec("block",[null,"block"])},next:function(){this.turn(-1)},prev:function(){this.turn(1)},go:function(a){if(this.block)return this.exec("block",[null,"block"]),0;a=Math.min(Math.max(a,0),this.lastIndex);var b=this.currentIndex,c=0,d=0,e=0;if(a>b)c=a,d=this.firstPage?this.lastIndex:b-1,e=b-c;else{if(!(b>a))return this.exec("block",[null,"same"]),0;c=this.lastPage?0:b+1,d=a,e=this.lastPage&&0===d?-1:b-d}if(this.updateSceneSequence(b,c,d),this.run("layout",[]),this.enabled){var f=[null,0,0,0,0,0,b];this.enabled=!1,this.moveDirection=e,this.run("start",f),this.run("end",f,200)}else this.exec("block",[null,"block"])},preventDefault:function(){var a=this,b=a.stage;b.on(i+" "+drawingEvent+" "+j,function(a){a.preventDefault()})},cancelBubble:function(){var a=this,b=a.stage;b.on(i+" "+drawingEvent+" "+j,function(a){a.stopPropagation()})},complete:function(a){var b=a.data,c=a.currentTarget;return b.enabled=!0,b.touched=!1,b.exitScene&&c!=b.exitScene[0]&&b.enterScene&&c!=b.enterScene[0]?(b.exec("block",[a,"mismatch"]),0):(b.currentIndex-=b.moveDirection,b.currentIndex>b.lastIndex?b.currentIndex=0:b.currentIndex<0&&(b.currentIndex=b.lastIndex),b.updateSceneIndex(b.currentIndex),void b.exec("complete",[a,b.currentIndex]))},off:function(){var a=this,b=(a.stage,a.scenes);b.off(i,"").off(k,"").off(j,"")},bind:function(a){var b=this,c=(b.stage,b.scenes);(!1===b.binded||!0===a)&&(b.off(),c.on(i,"",b,function(a){{var b=a.data,c="changedTouches"in a?a.changedTouches[0]:a;b.startX=c.pageX,b.startY=c.pageY}return!b.enabled||b.touched?(b.exec("block",[a,"block"]),1):b.touchEnabled?(b.moved=!1,b.moveDirection=0,b.enterScene=void 0,b.exitScene=void 0,void(b.touched=!0)):(b.exec("block",[a,"touch"]),1)}).on(k,"",b,function(a){var b=a.data,c="changedTouches"in a?a.changedTouches[0]:a,d=b.endX=c.pageX,e=b.endY=c.pageY,f=d-b.startX,h=e-b.startY,i=g.HORZIONTAL==b.direction?f:h,j=Math.abs(i),k=[a,d,e,f,h,i,b.currentIndex];if(b.locked||!b.enabled||!b.touched)return b.exec("block",[a,"block"]),1;if(!b.touchEnabled)return b.exec("block",[a,"touch"]),1;if(b.moveDirection=i/j,b.exec("movement",[].concat(k).concat([b.moveDirection])),!b.loop)switch(b.moveDirection){case 1:if(b.firstPage)return b.exec("block",[a,"firstpage"]),1;break;case-1:if(b.lastPage)return b.exec("block",[a,"lastpage"]),1}return j<b.offset*b.shiftRatio?(b.exec("block",[a,"distance"]),1):(b.moved=!0,(b.moveDirection!=b.lockedDirection||void 0===b.enterScene)&&(b.enterScene=b.moveDirection>0?b.nextScene:b.prevScene,b.lockedDirection=b.moveDirection,b.run("start",k)),void(j<b.offset*b.moveRatio&&b.run("move",k)))}).on(j,"",b,function(a){var b=a.data,c="changedTouches"in a?a.changedTouches[0]:a,d=b.endX=c.pageX,e=b.endY=c.pageY,f=d-b.startX,h=e-b.startY,i=g.HORZIONTAL==b.direction?f:h,j=[a,d,e,f,h,i,b.currentIndex];return!b.locked&&b.enabled&&b.touched?b.touchEnabled?b.moved?(b.touched=!1,b.enabled=!1,b.exec("shift",[].concat(j).concat([b.moveDirection])),void b.run("end",j)):(b.exec("block",[a,"move"]),1):(b.exec("block",[a,"touch"]),1):(b.exec("block",[a,"block"]),1)}),b.binded=!0)}};var m={newInstance:function(a,b,c,d,e){var f=new l(a,b,c,d,e);return{stage:f.stage,scenes:f.scenes,size:f.size,set:function(a,b){return f.set(a,b),this},isLocked:function(){return f.locked},setLocked:function(a){return f.setLocked(a),this},isTouchEnabled:function(){return f.isTouchEnabled()},setTouchEnabled:function(a){return f.setTouchEnabled(a),this},parseEffectAttributes:function(a){return f.parseEffectAttributes(a),this},setEffectAttribute:function(a,b){return f.setEffectAttribute(a,b),this},getEffectAttribute:function(a){return f.getEffectAttribute(a)},setMoveRatio:function(a){return f.moveRatio=a,this},setShiftRatio:function(a){return f.shiftRatio=a,this},setMovableDistance:function(a){return f.offset=a,this},getMovableDistance:function(){return f.offset},destroy:function(){return f.destroy(),this},restore:function(a){return f.restore(a),this},go:function(a){return f.go(a),this},next:function(){return f.next(),this},prev:function(){return f.prev(),this},off:function(){return f.off(),this},on:function(a){return f.bind(a),this},"import":function(a){return f.import(a),this},setSceneIndex:function(a){return f.sceneIndex=a,this},getSceneIndex:function(){return f.sceneIndex},updateStageSize:function(){f.updateStageSize()},getHandleStack:function(){return f.getHandleStack()}}}};module.exports=m});
