/*! Copyright (c) ZUIKU.COM - Author: LIJUN - Email: zwlijun@gmail.com */
define(function(require,exports,module){var a=require("mod/se/webapp.e47cf91536289f63a665036a527c389f6c143b12"),b=require("mod/se/util.23a019fe7e11928066d996128afdbb397a6fc330"),c=require("mod/sa/lightanimation.99760309ab7605392af133a11d24707db2120108"),d=require("mod/sa/scenetransitions.13dfb4facc16fc358b1e1eb748983e2eda2d2073"),e=require("mod/se/media.89d0df845887edf462b37881935a4cdf892ae3bd"),f=require("mod/se/cmd.8857ee41affbb16fe3b535cfe85d2be31f982851"),g=require("mod/se/storage.68fee00462a8c845f140085fcf156a09a744f7d2"),h=require("mod/polyfill/css.7891625883dcf7e67d40fc1000d57016eb4aa588"),i=require("mod/sa/scratchcard.aa5af97fceda44e575731a97e98ebcfde1cedd3d"),j=require("mod/sa/album.a012ce21d7e2a2cd6476d68d7072005601567ccd"),k=require("mod/open/jsapi/weixinapi.e74f6846f638073fa686848cfdda0889afdc3416"),l=require("mod/se/request.1352bd5b69b6d8a3f6c80e6a62b39695c0f336ee"),m=require("mod/se/dateutil.27c4af63c3568a74464286816e9980d4ced0d34a"),n=require("mod/se/lightscroll.a79fa1f6767c712034933470dc3d1050cf5e230e"),o=require("mod/se/stat.4861b3a4332c5a13ba8a58de61d948925f590420"),p=f.ResponseTypes,q=window.WebApp=a.newInstance("webapp","view",null,null),r=null,s=!1,t={},u=0,v=0,w=0,x="ontouchstart"in window,y=x?"touchstart":"mousedown",z=x?"touchend":"mouseup",A={like:{sync:{get:{url:"/show/like/get",data:"itemLikeId=${itemLikeId}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J},set:{url:"/show/like/set",data:"itemLikeId=${itemLikeId}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}},counter:{sync:{get:{url:"/show/vcounter/get",data:"itemCounterId=${itemCounterId}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}},"try":{sync:{get:{url:"/show/values/applications_num",data:"appId=${appId}&itemTryId=${itemTryId}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}}},B={callback:function(a,b){var c=$("#submit_tips");if(c.length>0){var d=$(window),e=(d.scrollLeft,d.scrollTop());c.html(b);var f=(c.offset(),Number(c.attr("data-offset")||30));c.css({top:f+e+"px",display:"block",opacity:1}),setTimeout(function(){c.css({opacity:0})},5e3)}else alert(b)}},C=function(a){var b=new Image;b.src=a},D=function(){var a=navigator.userAgent.toLowerCase();if(-1==a.indexOf("micromessenger"))return o.send("pv"),0;var c=k.MetaData,d=c.shareTitle,e=c.descContent,g=c.lineLink,h=c.imgUrl,i={imgUrl:h,link:g,title:d,desc:e,success:function(){c.shareClick&&C(c.shareClick),c.shareRedirectUrl&&(location.href=c.shareRedirectUrl),o.send("share")}},j={weixin:{bin:{sign:{url:"/service/share/weixinsign",data:"url=${url}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}}};f.injectCommands(j);var l=location.href,m=encodeURIComponent(l.replace(/(#[\w\W]*)/,"")),n={url:m};f.exec("weixin.bin.sign",n,{context:{showLoading:!1,allow:""+c.allow=="1"},success:function(a){var b=String(a.code),c=(a.msg,this.allow);"10"===b&&k.configure({debug:!1,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","chooseWXPay","showOptionMenu","hideOptionMenu","getNetworkType"]}).error({callback:function(){o.send("pv")}}).success({getNetworkType:{callback:function(a){var b={success:function(a){var b=a.networkType;o.setNetwork(b),o.send("pv")}};this.invoke(a,b)},args:[],context:k},showOptionMenu:{callback:function(a,b,c){!0===c&&this.invoke(a,b)},args:[{},c],context:k},hideOptionMenu:{callback:function(a,b,c){!0!==c&&this.invoke(a,b)},args:[{},c],context:k},onMenuShareTimeline:{callback:function(a,b){this.invoke(a,b)},args:[i],context:k},onMenuShareAppMessage:{callback:function(a,b){this.invoke(a,b)},args:[i],context:k},onMenuShareQQ:{callback:function(a,b){this.invoke(a,b)},args:[i],context:k},onMenuShareWeibo:{callback:function(a,b){this.invoke(a,b)},args:[i],context:k}})},error:function(a,c){var d=b.RequestStatus[c];f.fireError(d.status,d.text,B)}})},E={max:1/0,stack:[],push:function(a){E.stack.unshift(a),E.stack.length>E.max&&E.stack.pop()},back:function(a){var b=0;return a=Math.abs(a),b=E.stack[a]||E.stack[E.stack.length-1],E.stack.splice(0,Math.min(a+1,E.stack.length)),b},clear:function(){E.back(E.stack.length-1)},empty:function(){return 0===E.stack.length}};E.max=1;var F={get:function(){for(var a=$("[data-counter]"),b=a.length,c=null,d=null,e=null,f=null,h=0;b>h;h++)c=$(a[h]),d=c.attr("data-counter"),e=Number(g.Persistent.get("counter_"+d)||void 0),f=g.Persistent.get("counter_"+d+"_award")||"",e?(F.update(c,d,e),F.award(c,d,!!f,f)):F.request(c)},request:function(a){var b={itemCounterId:a.attr("data-counter")};f.exec("counter.sync.get",b,{context:{showLoading:!1,counter:a,key:b.itemCounterId},success:function(a){F.update(this.counter,this.key,a.count),F.award(this.counter,a.itemCounterId,a.awardFlag,a.awardUrl)},error:function(){}})},update:function(a,b,c){var d=Number(c);!isNaN(d)&&d>0&&(a.html(d),g.Persistent.set("counter_"+b,d,0))},award:function(a,b,c,d){var e=a.parents(".widget"),f=e.find(".js-counter-award");c&&d&&(g.Persistent.set("counter_"+b+"_award",d,0),f.removeClass("hide"),f.attr("data-action","Action://redirect#1,"+d+",0,0"))}},G={items:[],setItems:function(){var a=$("[data-tryid]"),b=a.length,c=null,d=null,e=null,f=null;G.items=[];for(var g=0;b>g;g++)f=$(a[g]),c=f.attr("data-deadline"),d=f.attr("data-appid"),e=f.attr("data-tryid"),G.items.push({node:f,deadline:c,appid:d,tryid:e})},get:function(){for(var a=G.items,b=a.length,c=null,d=null,e=null,f=null,g=0;b>g;g++)f=a[g],e=f.node,c=f.appid,d=f.tryid,this.request(g,e,c,d)},request:function(a,b,c,d){var e={appId:c,itemTryId:d};f.exec("try.sync.get",e,{context:{showLoading:!1,node:b},success:function(a){var b=this.node.find(".js-try-apply"),c=0;1==a.success&&(c=a.count||0),b.html(c)},error:function(){}})},counter:function(){for(var a=G.items,b=a.length,c=null,d=null,e=null,f=0;b>f;f++)e=a[f],d=e.node,c=e.deadline,this.start(f,d,c)},start:function(a,b,c){var d=m.parse(c,"%y-%M-%d %h:%m:%s").date,e=new Date,f=m.dateDiff("s",e,d),g=f,h=q.getTimer("try_timer_"+a,1,{callback:function(a){g--;var b=function(a){var b=Math.floor(a/86400),c=Math.floor((a-24*b*60*60)/3600),d=Math.floor((a-24*b*60*60-60*c*60)/60),e=Math.floor(a-24*b*60*60-60*c*60-60*d),f=b>=10?""+b:"0"+b,h=c>=10?""+c:"0"+c,i=d>=10?""+d:"0"+d,j=e>=10?""+e:"0"+e,k={days:f,hours:h,minutes:i,seconds:j,stop:!1};return 0>=g&&(k={days:"00",hours:"00",minutes:"00",seconds:"00",stop:!0}),k}(g);for(var c in b)b.hasOwnProperty(c)&&$(".js-"+c).html(b[c]);b.stop&&a.stop()}});h.start()}},H={Cache:{},find:function(module){for(var a=module.find(".js-widget-audio"),b=a.length,c=null,d=null,f=null,g=null,h=null,i=null,j=null,k=0;b>k;k++)c=$(a[k]),d=c.attr("data-wid"),f="1"===c.attr("data-autoplay"),g="1"===c.attr("data-loop"),h=c.attr("data-source"),j=c.attr("data-ctrl"),!h||h.length<8||d in H.Cache||(i={preload:"preload"},!0===f&&(i.autoplay="autoplay",$("widget_"+d).addClass(j)),!0===g&&(i.loop="loop"),H.Cache[d]=e.newInstance(MediaType.AUDIO,"audio_"+d,h),H.Cache[d].insert('[data-wid="'+d+'"]',i))},play:function(a,b,c){var d=H.Cache[a];H.stop(a),d&&(b.hasClass(c)?(d.pause(),b.removeClass(c)):(N.turnMusic("off"),d.play(),b.addClass(c)))},stop:function(a){var b=H.Cache,c=null,d=null,e=null,f=null;if(b)for(var g in b)a!==g&&b.hasOwnProperty(g)&&(c=b[g],d=$('[data-wid="'+g+'"]'),e=d.attr("data-ctrl"),f=$("#widget_"+g),f.removeClass(e),c.pause())}},I=function(a){this.key=a,this.view=$('[data-view="'+a+'"]'),this.st=null,this.timer=null,this.snap=null,this.fps=.3333333333333333,this.dotted=$("#"+a+"_dot").find("i")};I.prototype={create:function(a,b,c){var e=this,f=e.view,g=this.snap=f.attr("data-snap"),h=f.attr("data-effect"),i=f.attr("data-direction"),j="false"!=f.attr("data-loop"),k="false"!=f.attr("data-autoplay"),l=(e.fps=Number(f.attr("data-fps")||e.fps),f.attr("data-effectattr")||null);if(0!=$(g).length){$(g).css("position","absolute");var m=e.st=d.newInstance(g,h,i,j);m.set("interactive",{callback:function(a,b){if(!0===a&&b)for(var c=b.split(";"),d=c.length,e=0;d>e;e++){var f=c[e].split(":"),g=f[0],h=f[1];this.setEffectAttribute(g,h)}},context:m,args:[l]}),m.set("ready",{callback:function(a,b,c,d,f){var g=this;g.restore(d),g.on(!0),g.setMoveRatio(.8),g.setShiftRatio(.3),g.set("complete",{callback:function(a,b,c,d){c&&c[b]&&n.getInstance(d+"_"+b,c[b],null,q.layout.scale).configure(),this.dotted&&this.dotted.length>0&&(this.dotted.removeClass("on"),$(this.dotted[b]).addClass("on"))},context:e,args:[b,c]}),g.set("start",{callback:function(a){null!=a&&this.stop()},context:e}),!0===k&&!0===j&&f.autoplay()},context:m,args:[a,b,c,this]}).import(!1)}},autoplay:function(){if(0!=$(this.snap).length){var a=this.timer=q.getTimer(this.key,this.fps,{callback:function(){this.st.next()},context:this});a.start()}},stop:function(){0!=$(this.snap).length&&this.timer&&this.timer.stop()},destroy:function(){0!=$(this.snap).length&&this.st.destroy()}},I.Map={},I.getInstance=function(a){return a in I.Map?I.Map[a]:I.Map[a]=new I(a)},I.lookup=function(){var a=q.view.find(".st-album");$.each(a,function(a,b){I.getInstance($(b).attr("data-view")).create(null,null,0)})};var J={List:[],firstPageIndex:0,total:0,right:0,wrong:0,lookup:function(){var a=$('[data-type="kb"]');J.List=[],J.total=0,J.right=0,J.wrong=0,$.each(a,function(a,b){var c=$(b),module=null;0===a&&(module=c.parents("section"),J.firstPageIndex=Number(module.attr("data-sn")||0)),c.attr("data-lockapp","1").attr("data-kbindex",a).attr("data-completed","0"),c.find("li").attr("data-kbindex",a).removeClass(),J.List[a]=0,J.total++})},getAnswer:function(a){return J.List[a]||0},setAnswer:function(a,b){J.List[a]=b},isLastQuestion:function(){for(var a=J.List.length,b=0,c=!0,d=0;a>d;d++)if(b=J.getAnswer(d),0===b){c=!1;break}return c},checkAnswer:function(a,b,c,d){var e=["kas-wrong","kas-right"],f="2"==d?1:0;return 1===f?J.right++:J.wrong++,a.addClass(e[f]),a.parent().parent().attr("data-lockapp","0"),q.setLocked(!1),J.setAnswer(b,c),J.isLastQuestion()?(J.displayResult(!0),q.setLocked(!0),!0):!1},displayResult:function(a){var c=$("#kb_result"),d=$("#tpl_kb_result");if(!0===a){var e={total:J.total,right:J.right,rate:Math.round(J.right/J.total*100)};c.html(b.formatData(d.html(),e,"#")),c.removeClass("hide")}else q.setLocked(!1),c.addClass("hide")}},K=function(a,b){var c=(a.attr("data-enabled"),60),d=a.attr("data-text"),e=null;!0===b?null!=e&&(clearTimeout(e),e=null,a.html(d),a.attr("data-enabled","1")):(a.html(d+"("+c+")"),a.attr("data-enabled","0"),e=setTimeout(function(){--c,0>=c?(c=0,a.html(d),a.attr("data-enabled","1")):(a.html(d+"("+c+")"),setTimeout(arguments.callee,1e3))},1e3))},L=function(a){for(var b=a.attr("name"),c=a.attr("action"),d=a.attr("method"),e=a[0],g=e.elements,h=g.length,i=null,j=null,k=/^(\s+)|(\s+)$/g,l=null,m=null,n=null,o=null,p={},q=!0,r=0;h>r;r++)if(i=g[r],j=i.value.replace(k,""),o=i.name,m=i.tagName.toUpperCase(),n=(i.type||"").toUpperCase(),l=i.getAttribute("data-tips"),q="0"!=i.getAttribute("data-required"),"BUTTON"!=m&&"BUTTON"!=n&&"SUBMIT"!=n&&"RESET"!=n&&"IMAGE"!=n){if(("CHECKBOX"==n||"RADIO"==n)&&(j=function(a,b){for(var c=a.find('[name="'+b+'"]'),d=[],e=0;e<c.length;e++)!0===c[e].checked&&d.push(c[e].value);return d.length>0?d.join(","):""}(a,o)),q&&""==j&&"HIDDEN"!=n)return f.fireError("0x03",l,B),!1;p[o]=encodeURIComponent(j)}return{domNode:e,name:b,action:c,method:d,data:p}},M=null,N={popbox:function(a,d){var e=a.split("~"),f=e[0],g=e[1],h=null,i=d.attr("data-popbox"),j=i?$("#"+i):d.parents("section").find(".popbox"),k=j.attr("data-rs"),l=j.find(".ppb-title"),m=l.offset(),p=j.offset(),r=j.find('[data-calc="1"]'),t=j.find('[data-scrollview="1"]'),u=j.attr("data-moduleid");if(r.length>0&&r.css({height:(p.height-m.height)/q.layout.scale+"px",overflow:"auto"}),s="visible"==f?!0:!1,q.setLocked(s),g&&(h=M||(M=c.newInstance(j,g)),h.updateTarget(j),h.source(g),h.set("complete",{callback:function(a,b){b&&(k?N.comments(i,k):(t.length>0&&(u=t.attr("data-subkey"),n.getInstance(u,t[0],null,q.layout.scale).configure()),Q.scroll.viewport[u]&&Q.scroll.viewport[u].refresh().configure()))},args:[s]}),h.play()),b.setActionHook(j),j.on("touchmove",function(a){a.stopPropagation()}),"visible"==f){var v=d.parents("[data-moduleid]").attr("data-moduleid");o.send("click",v)}},unfold:function(a,b){var d=a.split("|"),e=b.attr("data-unfold")||"1",f=b.parents(".itbox"),g="transition::"+("1"==e?d[0]:d[1]),h=c.newInstance(f,g);h.updateTarget(f),h.source(g),h.set("complete",{callback:function(a,b,c){var d=Number(b),e=+!d,f=["icon-round-less","icon-round-add"];c.attr("data-unfold",e),c.removeClass(f[d]).addClass(f[e])},args:[e,b]}),h.play(),f.one("touchmove",function(a){a.stopPropagation()})},view:function(a){var b=a.split(","),c=b[0],d=b[1],e=Number(b[2]),f=isNaN(e)?0:e,g=$('[data-view="'+d+'"]'),h=g.attr("data-slider"),i="sliderview"==h,j=i?I.getInstance(d):null,k=g.find(".subview"),l=g.find(".mask-cont");l=l.length>0?l:g.find(".mask-slide"),"more"==c?(g.removeClass("hide"),q.setLocked(!0),j?j.create(k,d,f):n.getInstance(d+"_"+f,k[f],null,q.layout.scale).configure()):"close"==c&&(g.addClass("hide"),j&&j.destroy(),q.setLocked(!1))},mask:function(a){var b=a.split(","),c=b[0],d=b[1],e=b[2]||"normal",f=$('[data-moduleid="'+d+'"].share-mask');if(f.attr("data-mtype",e),"show"==c){f.one("touchend",function(a){var b=$(a.currentTarget),c=b.attr("data-mtype");q.setLocked(!1),"video"==c&&(b.find("iframe").parent().html(""),N.turnMusic("on")),f.addClass("f-hide")}),f.removeClass("f-hide");var g=f.find('[data-type="maskscroller"]');if(g.length>0&&(g.on("touchend",function(a){a.stopPropagation()}),n.getInstance(d,g[0],null,q.layout.scale).configure(),q.setLocked(!0)),"map"==e||"panoramic"==e){var i=f.find("iframe");i.attr("data-src")&&(i.attr("src",i.attr("data-src")),i.removeAttr("data-src")),i=null}else if("video"==e){var j=f.parents(".innerbox").offset();if(!(d in t)){var k=f.find("#tpl_video_"+d),l=null;k.length>0&&(l=k.parent(),t[d]={code:k.html(),node:l}),k=null,l=null}N.turnMusic("off");var m=t[d];m.node.html(m.code);var o=m.node.find("iframe"),p=j.width/q.layout.scale/2,r=j.height/q.layout.scale*.45/2;o.length>0&&(o.attr("width",p).attr("height",r).css({width:p+"px",height:r+"px"}),h.css(o,"transform-origin","center center 0"),h.css(o,"transform","scale(2)"))}}},widgetAudio:function(a,b){var c=a.split(",");H.play(c[0],b,c[1])},turnMusic:function(a){var b=$(".icon-audio");b.length>0&&!b.hasClass("hide")&&N.music(a,b,null)},music:function(a,b){var c=b.parent(),d=c.find(".icon-audio-on"),e=c.find(".icon-audio-off");"on"==a?(r.play(),e.addClass("hide"),d.removeClass("hide")):(r.pause(),d.addClass("hide"),e.removeClass("hide"))},verify:function(a,c){var d=c.parents("form"),e=a.split(","),g=e[0],h=e[1],i=e[2],j=c.attr("data-param"),k=j.split(","),l=k.length,m={},n=null,o=null,q=null,r=null,s={},t=c.attr("data-enabled")||"1";if("1"!=t)return!1;for(var u=0;l>u;u++){if(n=k[u],q=d.find("#"+n),o=q.val(),r=q.attr("data-tips"),!o)return f.fireError("0x04",r,B),!1;m[n]=o}s[g]={bin:{get:{url:h,data:"t=${timestamp}&"+i.replace(/@/g,"$"),method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}},f.injectCommands(s),K(c,!1),m.timestamp=(new Date).getTime(),f.exec(g+".bin.get",m,{success:function(a){var b=a.code,d=a.msg;"0"===b?f.fireError("0x00","发送成功",B):(f.fireError("0x01",d||"发送成功",B),K(c,!0))},error:function(a,d){var e=b.RequestStatus[d];f.fireError(e.status,e.text,B),K(c,!0)}})},submit:function(a,c){var d=c.parents("form"),e=L(d);if(!e)return!1;var h=e.data,i=e.name,j=e.action,k={};k[i]={bin:{commit:{url:j,data:"",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}};var l=["t="+(new Date).getTime()];for(var m in h)l.push(m+"="+h[m]);if(k[i].bin.commit.data=l.join("&"),f.injectCommands(k),f.exec(i+".bin.commit",null,{context:{form:e.domNode},success:function(d){var e=d.success,h=d.data,i=!0;if(!0===e){if(f.fireError("0x00",h||"提交成功",B),"comment"==a){var j=c.parents(".popbox"),k=j.find("[data-popbox]"),l=j.attr("data-rs");N.comments(k.attr("data-popbox"),l)}else if(("wxpay"==a||"wxhb"==a)&&d.orderId){var m=this.form.elements,n=m.appId.value,o=m.linkType.value,p=m.linkUrl.value,r=m.redirect.value,s=r+"?redirect_type="+o+"&appId="+n+"&orderId="+d.orderId+"&url="+p+"&t_="+(new Date).getTime()+"&showwxpaytitle=1";g.Session.set("s"+n,q.getCurrentIndex()),this.form&&this.form.reset();var j=c.parents(".popbox"),t=j.find(".icon-close");b.fireAction(t,null),setTimeout(function(){location.href=s},300)}i&&this.form&&this.form.reset()}else f.fireError("0x01",h||"提交失败",B)},error:function(a,c){var d=b.RequestStatus[c];f.fireError(d.status,d.text,B)}}),"wxpay"==a||"wxhb"==a){var n=d.attr("name").replace(/[^0-9]+/g,"");o.send("click",n)}},comments:function(a,b){var c={},d=1,e=$("#"+a).attr("data-moduleid");c[a]={bin:{rs:{url:b,data:"t=${timestamp}&page=${page}",method:"POST",cross:!1,spa:!1,replace:!1,cache:"auto",append:"auto",dataType:p.J}}},f.injectCommands(c),Q.scroll.popbox[e]=a,Q.scroll.htmlList=[],Q.scroll.page=1,Q.scroll.pageCount=1,Q.scroll.loadComments(a,d,e)},unblock:function(a){var b=a.split(",");O.Pool[b[1]].fireCircle(Number(b[0]))},gotoAndPlay:function(a){var b=a.split(","),c=Number(b[0]),d=Number(b[1]);c=isNaN(c)?0:c,d=isNaN(d)?0:d,d>0?setTimeout(function(){q.releaseLock(),q.releaseForceLock(),q.go(c)},d):(q.releaseForceLock(),q.releaseLock(),q.go(c))},gotoNext:function(){q.releaseForceLock(),q.releaseLock(),q.next()},gotoPrev:function(){q.releaseForceLock(),q.releaseLock(),q.prev()},redirect:function(a,b,c){var d=a.split(","),e=Number(d[0]),f=decodeURIComponent(d[1]||""),h=Number(d[2]||0),i=Number(d[3]||0),j=b.parents("[data-moduleid]").attr("data-moduleid");switch(e){case 1:g.Session.set("s"+q.appKey,q.getCurrentIndex()),setTimeout(function(){location.href=f},i),o.send("click",j);break;case 2:E.push(q.getSceneIndex()),N.gotoAndPlay(h+","+i,b,c),o.send("click",j)}},back:function(a,b,c){var d=E.back(0);N.gotoAndPlay(d+","+a,b,c)},checkAnswer:function(a,b){var c=a.split(","),d=Number(c[0]),e=Number(c[1]),f=Number(c[2]),g=b.parent().parent(),h=g.attr("data-kbindex"),i=g.attr("data-completed"),j=!1;"1"!=i&&(g.attr("data-completed","1"),j=J.checkAnswer(b,h,d,e)),j||setTimeout(function(){q.next()},f)},againAnswer:function(a,b,c){J.displayResult(!1),J.lookup(),N.gotoAndPlay(J.firstPageIndex+",0",b,c)},overAnswer:function(a,b,c){J.displayResult(!1),N.gotoNext(a,b,c)},like:{get:function(a){var b=a.split(","),c=b[0],d=b[1],e=b[2],h={itemLikeId:c};f.exec("like.sync.get",h,{context:{showLoading:!1,likeId:c,likeStyle:d,likeType:e},success:function(a){var b=0;a&&a.count&&(b=a.count),$("#like_"+this.likeId).html(b);var c=g.Persistent.get("like_"+this.likeId),d=$('[data-likeId="'+this.likeId+'"]');""+c==""+this.likeId&&("1"==this.likeType?d.addClass(this.likeStyle):d.removeClass(this.likeStyle).addClass(this.likeStyle+"-on")),d.removeClass("hide")},error:function(){}})},set:function(a){var b=a.split(","),c=b[0],d=b[1],e=b[2],h={itemLikeId:c},i=g.Persistent.get("like_"+c);return""+i==""+c?0:void f.exec("like.sync.set",h,{context:{showLoading:!1,likeId:c,likeStyle:d,likeType:e},success:function(a){var b=0;a&&a.count&&(b=a.count),$("#like_"+this.likeId).html(b),g.Persistent.set("like_"+this.likeId,this.likeId,0),"1"==this.likeType?$('[data-likeId="'+this.likeId+'"]').addClass(this.likeStyle):$('[data-likeId="'+this.likeId+'"]').removeClass(this.likeStyle).addClass(this.likeStyle+"-on")},error:function(){}})}},checkBuyQuantity:function(a,b){var c=Number(b.attr("data-min")||"1"),d=Number(b.attr("data-max")||"10"),e=Number(b.attr("data-amount")),f=b.parent().find(".js-fee"),g=b.val(),h=Number(g),i=isNaN(h)?1:Math.ceil(h);i=Math.max(Math.min(i,d),c),g&&b.val(i),f.html((i*e).toFixed(2))}},O=function(a,b){this.key=b,this.timer=null,this.timer1=null,this.timer2=null,this.timer3=null,this.touchNum=0,this.touchFinish=!1,this.view=a,this.mask=$(a),this.circle1=this.mask.find(".mask-circle-1"),this.circle2=this.mask.find(".mask-circle-2"),this.circle3=this.mask.find(".mask-circle-3"),this.touch1=this.mask.find(".touch-1"),this.touch2=this.mask.find(".touch-2"),this.touch3=this.mask.find(".touch-3"),this.touch4=this.mask.find(".touch-4")};O.prototype={fireCircle:function(a){this.touchNum+=1;var b=this["circle"+a];switch(b.addClass("hide"),a){case 1:this.animate(2);break;case 2:this.animate(1);break;case 3:this.animate(3)}},back:function(){this.touchNum>=3&&!this.touchFinish&&(this.touchFinish=!0,this.animate(""),this.view.attr("data-unlocked","1").attr("data-lockapp","0"),q.setLocked(!1))},animate:function(a){var b=offset=time=0,c=this;clearInterval(c["timer"+a]),""==a?c.timer=setInterval(function(){b>=4&&(b=0,offset=offset>=5?0:offset+=1),c.touch4.css("-webkit-mask-position",640*-b+"px "+-offset*q.layout.design.height+"px"),b+=1,time++,time>=20&&(clearInterval(c.timer),c.touch1.addClass("hide"),c.touch2.addClass("hide"),c.touch3.addClass("hide"),c.touch4.css("-webkit-mask","none!importnat"))},80):c["timer"+a]=setInterval(function(){b>=4&&(b=0,offset=offset>=3?0:offset+=1),c["touch"+a].css("-webkit-mask-position",(3==a?640*-b-20:640*-b)+"px "+-offset*q.layout.design.height+"px"),b+=1,time++,time>=12&&(clearInterval(c["timer"+a]),c.back())},60)}},O.Pool={};var P=function(a){this.finger=a,this.prevDoor=a.find(".door-prev"),this.nextDoor=a.find(".door-next"),this.fingerprint=a.find(".fingerprint"),this.startTime=0,this.stopTime=0,this.scanTimer=null,this.stopTimer=null};P.prototype={create:function(){this.fingerprint[0].addEventListener(y,this,!1),this.fingerprint[0].addEventListener(z,this,!1)},destroy:function(){this.fingerprint[0].removeEventListener(y,this,!1),this.fingerprint[0].removeEventListener(z,this,!1)},clearTimer:function(a){var b=a+"Timer";return null!=this[b]&&(clearTimeout(this[b]),this[b]=null),this},startScan:function(){var a=this;a.startTime=(new Date).getTime(),a.fingerprint.addClass("activating"),a.clearTimer("scan").clearTimer("stop"),a.scanTimer=setTimeout(function(){a.fingerprint.addClass("hide"),a.finger.addClass("opening")},1e3),a.stopTimer=setTimeout(function(){a.finger.addClass("hide"),a.finger.attr("data-lockapp","0"),a.destroy(),q.setLocked(!1)},3016)},stopScan:function(){var a=this,b=0;a.stopTime=(new Date).getTime(),b=a.stopTime-a.startTime,a.fingerprint.removeClass("activating"),1e3>b&&a.clearTimer("scan").clearTimer("stop")},handleEvent:function(a){var b=a.type;switch(b){case"touchstart":case"mousedown":this.startScan(a);break;case"touchend":case"mouseup":this.stopScan(a)}}},P.lookup=function(){var a=q.view.find(".finger-unlock");$.each(a,function(a,b){new P($(b)).create()})};var Q={unblock:{view:null,init:function(a,b,c){this.view=$(a),O.Pool[c]=O.Pool[c]||new O($(a),c)}},slide:{view:null,album:null,reset:function(){var a=this.view.parent(),b=a.attr("data-width"),c=a.attr("data-height"),d=this.view.find(".subscroller"),e=this.view.find('[data-type="photo"]'),f=this.view.find('[data-type="photos"]');this.view.css({width:b+"px",height:c+"px"}),d.css({width:b+"px",height:c+"px"}),f.removeAttr("style"),$.each(e,function(a,b){b.style.cssText="background-image: "+b.style.backgroundImage})},show:function(module,a){this.view=a,this.reset();var b=a.data("moduleid"),c=this.album=j.newInstance("album_"+b,!0,q.layout.scale);c.load()},init:function(a){this.view=$(a),this.reset()}},scroll:{viewport:{},popbox:{},page:1,pageCount:1,htmlList:[],loadComments:function(a,c,d){f.exec(a+".bin.rs",{page:c,timestamp:(new Date).getTime()},{context:{subkey:d},success:function(c){for(var d=$("#"+a+"_tpl").html(),e=$("#"+a+"_rs"),f=$("#"+a+"_item_tpl").html(),g=c.list,h=g.length,i=null,j=Q.scroll,k=this.subkey,m={count:c.count||0,list:""},n=0;h>n;n++)i=g[n],i.itemCommentName=l.filterScript(i.itemCommentName),i.itemCommentInfo=l.filterScript(i.itemCommentInfo),i.itemFormValueAddTime=i.itemFormValueAddTime.substr(0,10),j.htmlList.push(b.formatData(f,i,"#"));m.list=j.htmlList.join(""),e.html(b.formatData(d,m,"#")),j.viewport[k]&&(j.viewport[k].request=!1,j.page=c.page,j.pageCount=c.pageCount,j.viewport[k].refresh().configure())},error:function(a,c){var d=b.RequestStatus[c];f.fireError(d.status,d.text,B)}})},init:function(a,b,c){var d=this.viewport[c]=n.getInstance(c,a,null,q.layout.scale);d.set("start",{callback:function(){this.request=!1,this.refresh().configure()},context:d}).set("push",{callback:function(a,b,c,d){var e=Q.scroll,f=e.popbox[d],g=e.page,h=e.pageCount;this.request=!0,h>g?e.loadComments(f,g+1,d):(this.request=!1,B.callback("","最后一页了"))},args:[c],context:d}).set("scrolling",{callback:function(a){a.preventDefault(),a.stopPropagation()}}).configure()}},init:function(){for(var a=$("[data-subview]"),b=a.length,c=null,d=null,e=null,f=null,g=-1,h=0;b>h;h++)c=$(a[h]),d=c.attr("data-subview"),e=c.attr("data-subkey"),-1!=(g=d.indexOf("#"))&&(f=d.substring(g+1),d=d.substring(0,g)),d in Q&&Q[d].init(c[0],f,e)}},R=function(){var a=q.app,b=a.data("distance")||100,c=q.getSceneMovableDistance(),d=b/c;q.updateSceneShiftRatio(d)},S=function(){var a=$(".widget.hidden");$.each(a,function(a,b){var c=$(b);c.attr("data-widget")||c.removeClass("hidden").addClass("visible")})},T=function(module,a){var b=["hidden","visible"],c=b[+a],d=b[+!a],e=module.find("[data-widget]");$.each(e,function(a,b){var e=$(b);e.removeClass(d).addClass(c)})},U=function(a){var b=$('[data-type="arrow"]');!0===a?b.removeClass("hide"):b.addClass("hide")};q.set("createbefore",{callback:function(){var a=location.hash.replace("#",""),b=q.app.attr("data-appkey"),c=Number(g.Session.get("s"+b)||a||"0");c=isNaN(c)?0:c,u=c,q.setSceneIndex(c),g.Session.remove("s"+b),q.setLazyLoading(4)}}),q.set("create",{callback:function(){U(1!==q.modules.length),S(),q.showModuleWidget(0),Q.init();var a=$("#submit_tips");$("body").one("touchstart",function(){N.turnMusic("on")}),a.on("webkitTransitionEnd",function(a){a.stopPropagation();var b=$(a.target);0==Number(b.css("opacity"))&&b.css("display","none")}),h.css(a,"transition","opacity .4s ease"),$(document).on("touchmove",function(a){a.preventDefault()}),P.lookup(),I.lookup(),J.lookup(),F.get(),G.setItems(),G.get(),G.counter(),D(),R(),v=Math.max(document.documentElement.clientWidth,window.innerWidth),w=Math.max(document.documentElement.clientHeight,window.innerHeight)}}),q.set("exit",{callback:function(a,b,c,d,e,f,g){var h=q.modules,module=$(h.get(g)),i=module.find('[data-subview="slide"]'),j=Q.slide;i.length>0&&j.reset(),H.stop(),U(!0),T(module,!1)}}),q.set("start",{callback:function(a){null!=a&&E.clear()}}),q.set("end",{callback:function(a,b){{var c=q.modules,module=$(c.get(b)),d=module.find(".copyright"),e=module.find('[data-subview="slide"]'),f=module.find('[data-lockapp="1"]'),g=module.find("[data-likeId]");Q.slide}if(e.length>0&&Q.slide.show(module,e),f.length>0&&q.setLocked(!0),d.length>0&&d.css("z-index",999999),H.find(module),g.length>0)for(var h=0,i=g.length;i>h;h++){var j=$(g[h]);N.like.get(j.attr("data-likeId")+","+j.attr("data-likeStyle")+","+j.attr("data-likeType"),null,null)}U(c.length>1?!(!q.isSceneLoop()&&b===c.length-1):!1),E.empty()?$("#goback").addClass("hide"):$("#goback").removeClass("hide")}}),q.set("widgetplay",{callback:function(module,a){a.removeClass("hidden").addClass("visible")}}),q.set("update",{callback:function(a,b,c){for(var d=[{s:".icon-audio.f-top0",p:{"transform-origin":"right top 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:".icon-audio.f-bottom0",p:{"transform-origin":"right bottom 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:".copyright",p:{left:"50%","margin-left":"-"+c.width/2+"px",width:c.width+"px","transform-origin":"center bottom 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:".icon-arrow-left",p:{"transform-origin":"right center 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:".icon-arrow-up",p:{"transform-origin":"center bottom 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:"#submit_tips",p:{"transform-origin":"center center 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:"#goback",p:{"transform-origin":"left top 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}},{s:".js-loading .loading-panel",p:{"transform-origin":"center center 0",transform:"translate(0, 0) translateZ(0) scale("+a+", "+a+")"}}],e=d.length,f=null,g=null,i=null,j=0;e>j;j++){f=d[j],i=$(f.s),g=f.p;for(var k in g)g.hasOwnProperty(k)&&h.css(i,k,g[k])}},context:q}),q.set("resize",{callback:function(){var a=(Math.max(document.documentElement.clientWidth,window.innerWidth),Math.max(document.documentElement.clientHeight,window.innerHeight));48>=w-a&&this.resize()},context:q});var V={version:"B15R0627",app:q,SubView:Q,MaskLayer:i,LightAnimation:c,setAudio:function(a,b){try{var c={preload:"preload",loop:"loop"};!1!==b&&(c.autoplay="autoplay"),r=e.newInstance(MediaType.AUDIO,"audio",a),r.insert(".icon-audio",c),$(".icon-audio").removeClass("hide")}catch(d){}}};b.setActionHook(),b.setActionHook("form","input"),b.injectAction(N),f.injectCommands(A),module.exports=V});
